## Overview
This writeup details the reverse engineering of an Android application that requires to invoke a hidden instance method that decrypts and reveals the flag. The goal is to construct a `Checker` object, hook into the application lifecycle, and call the `get_flag()` method.

## Initial analysis
The `AndroidManifest.xml` shows a simple application structure with the main activity `com.ad2001.frida0x6.MainActivity` as the entry point.

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android" android:versionCode="1" android:versionName="1.0" android:compileSdkVersion="33" android:compileSdkVersionCodename="13" package="com.ad2001.frida0x6" platformBuildVersionCode="33" platformBuildVersionName="13">
    <uses-sdk android:minSdkVersion="28" android:targetSdkVersion="33"/>
    <permission android:name="com.ad2001.frida0x6.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION" android:protectionLevel="signature"/>
    <uses-permission android:name="com.ad2001.frida0x6.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION"/>
    <application android:theme="@style/Theme.Frida0x6" android:label="@string/app_name" android:icon="@mipmap/ic_launcher" android:debuggable="true" android:allowBackup="true" android:supportsRtl="true" android:extractNativeLibs="false" android:fullBackupContent="@xml/backup_rules" android:roundIcon="@mipmap/ic_launcher_round" android:appComponentFactory="androidx.core.app.CoreComponentFactory" android:dataExtractionRules="@xml/data_extraction_rules">
        <activity android:name="com.ad2001.frida0x6.MainActivity" android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
        <provider android:name="androidx.startup.InitializationProvider" android:exported="false" android:authorities="com.ad2001.frida0x6.androidx-startup">
            <meta-data android:name="androidx.emoji2.text.EmojiCompatInitializer" android:value="androidx.startup"/>
            <meta-data android:name="androidx.lifecycle.ProcessLifecycleInitializer" android:value="androidx.startup"/>
        </provider>
    </application>
</manifest>
```
## Java analysis
Decompiling the APK with `jadx-gui` reveals the `MainActivity` class containing an instance method `get_flag()`. The method performs the following operations:
1. Checks if the values for the `Checker` instance are `1234` and `4321`. This object is never instantiated by the application;
2. If the check passes, decrypts a Base64-encoded encrypted string using AES encryption;
3. Uses the key "MySecureKey12345" for decryption;
4. Displays the decrypted flag in a TextView.

The challenge requires creating a `Checker` object with the correct values and passing it to the `get_flag()` method.

```java
package com.ad2001.frida0x6;

import android.os.Bundle;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.util.Base64;
import javax.crypto.BadPaddingException;
import javax.crypto.Cipher;
import javax.crypto.IllegalBlockSizeException;
import javax.crypto.NoSuchPaddingException;
import javax.crypto.spec.SecretKeySpec;

/* loaded from: classes3.dex */
public class MainActivity extends AppCompatActivity {

    /* renamed from: t1 */
    TextView f103t1;

    /* JADX INFO: Access modifiers changed from: protected */
    @Override // androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(C0569R.layout.activity_main);
        this.f103t1 = (TextView) findViewById(C0569R.C0572id.textview);
    }

    public void get_flag(Checker A) throws NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException {
        if (1234 == A.num1 && 4321 == A.num2) {
            Cipher cipher = Cipher.getInstance("AES");
            SecretKeySpec secretKeySpec = new SecretKeySpec("MySecureKey12345".getBytes(), "AES");
            cipher.init(2, secretKeySpec);
            byte[] decryptedBytes = Base64.getDecoder().decode("QQzMj/JNaTblEHnIzgJAQkvWJV2oK9G2/UmrCs85fog=");
            String decrypted = new String(cipher.doFinal(decryptedBytes));
            this.f103t1.setText(decrypted);
        }
    }
}
```

File: Checker.java

```java
package com.ad2001.frida0x6;

/* loaded from: classes3.dex */
public class Checker {
    int num1;
    int num2;
}
```

The solution involves two main functions. First, `initiateCheck()` creates a new instance of the `Checker` class using Frida's `$new()` method and sets the required field values to `1234` and `4321`. Second, `callGetFlag()` hooks the `onCreate()` method to intercept the Activity lifecycle, then calls `get_flag()` with the prepared `Checker` instance once the Activity is properly initialized.

```js
function initiateCheck() {
    var Check = Java.use("com.ad2001.frida0x6.Checker");

    var instance = Check.$new();

    instance.num1.value = 1234;
    instance.num2.value = 4321;

    return instance;
}

function callGetFlag(instance) {
    var MainActivity = Java.use("com.ad2001.frida0x6.MainActivity");

    MainActivity.onCreate.implementation = function (b) {
        this.onCreate(b);
        console.log("[*] onCreate hooked, calling flag()");
        this.get_flag(instance);
    };
}

Java.perform(function () {
    var instance = initiateCheck();
    callGetFlag(instance);
});
```

Running the Frida script successfully hooks the application, creates the `Checker` instance with the correct values, and calls `get_flag()` during the Activity creation. The AES decryption is triggered and the flag is displayed on screen.

```shell
$ frida -U -l script.js -f com.ad2001.frida0x6
     ____
    / _  |   Frida 16.7.13 - A world-class dynamic instrumentation toolkit
   | (_| |
    > _  |   Commands:
   /_/ |_|       help      -> Displays the help system
   . . . .       object?   -> Display information about 'object'
   . . . .       exit/quit -> Exit
   . . . .
   . . . .   More info at https://frida.re/docs/home/
   . . . .
   . . . .   Connected to Pixel 4a (id=)
Spawned `com.ad2001.frida0x6`. Resuming main thread!                    
[Pixel 4a::com.ad2001.frida0x6 ]-> [*] onCreate hooked, calling flag()
```

## Flag
FRIDA{INSTANCES_AND_INSTANCES}